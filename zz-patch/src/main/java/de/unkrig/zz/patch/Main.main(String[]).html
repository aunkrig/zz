<html>
  <body>
<h2>Usage</h2>

<dl>
  <dt><code>zzpatch</code> [ <var>option</var> ... ]</dt>
  <dd>
    Transforms STDIN to STDOUT.
  </dd>
  <dt><code>zzpatch</code> [ <var>option</var> ... ] <var>file-or-dir</var></dt>
  <dd>
    Transforms <var>file-or-dir</var> in-place.
  </dd>
  <dt><code>zzpatch</code> [ <var>option</var> ... ] <var>file-or-dir</var> <var>new-file-or-dir</var></dt>
  <dd>
    Transforms <var>file-or-dir</var> into <var>new-file-or-dir</var>.
  </dd>
  <dt><code>zzpatch</code> [ <var>option</var> ... ] <var>file-or-dir</var> ... <var>existing-dir</var></dt>
  <dd>
    Transforms <var>file-or-dir</var> ..., creating the output in <var>existing-dir</var>.
  </dd>
</dl>

<h2>Options</h2>

<h3>File transformation options:</h3>
<dl>
  <dt><code>--update</code>       <var>glob</var><code>=</code><var>update-file</var>    [ <var>condition</var> ... ]</dt>
  <dd>Replace the contents of files/archive entries that match <var>glob</var> (see below) with that of the
<var>update-file</var>.</dd>
  <dt><code>--substitute</code> <var>glob</var> <var>pattern</var> <var>replacement</var> [ <var>condition</var> ... ]</dt>
  <dd>Replace all matches of <var>pattern</var> in files/archive entries that match <var>glob</var> (see below) with
the <var>replacement</var> string. "<code>$0</code>", "<code>$1</code>", "<code>$2</code>", etc. expand to the captured groups
of the match.
<p>
  Conditions (see below) apply per match; the parameters of the "<code>--report</code>" and "<code>--iff</code>"
  conditions are:
</p>
<dl>
  <dt><var>path</var></dt>
  <dd>The "path" of the file or ZIP entry that contains the match</dd>
  <dt><var>match</var></dt>
  <dd>The matching text</dd>
</dl></dd>
  <dt><code>--patch</code> <var>glob</var> <var>patch-file</var>             [ <var>condition</var> ... ]</dt>
  <dd>Apply <var>patch-file</var> to all files/archive entries that match <var>glob</var> (see below).
<var>patch-file</var> can be in traditional, context or unified diff format.
<p>
  Conditions (see below) apply per match; the parameters of the "<code>--report</code>" and "<code>--iff</code>"
  conditions are:
</p>
<dl>
  <dt><var>path</var></dt>
  <dd>The "path" of the file or ZIP entry being patched</dd>
  <dt><var>hunks</var></dt>
  <dd>The hunks being applied</dd>
  <dt><var>hunkIndex</var></dt>
  <dd>The index of the current hunk</dd>
  <dt><var>lineNumber</var></dt>
  <dd>The line number where the hunk starts</dd>
</dl></dd>
  <dt><code>--remove</code> <var>glob</var>    [ <var>condition</var> ... ]</dt>
  <dd>Remove all files/archive entries that match <var>glob</var> (see below).</dd>
  <dt><code>--rename</code> <var>glob</var>    [ <var>condition</var> ... ]</dt>
  <dd>Rename files/archive entries according to <var>glob</var> (see below), e.g. "<code>(*).c=$1.c.orig</code>".
Multiple "<code>--rename</code>" options are applied in the given order.</dd>
  <dt><code>--add</code> <var>glob</var> <var>name</var> <var>contents-file</var>       [ <var>condition</var> ... ]</dt>
  <dd>To all directories and archives that match <var>glob</var>, add a member/entry <var>name</var>, and fill it
from <var>contents-file</var>.</dd>

</dl>

<h3>File transformation conditions:</h3>

<p>These control the preceding file transformation.</p>

<dl>
  <dt><code>--report</code> <var>expr</var></dt>
  <dd>
    Evaluate and print the <var>expr</var> each time the preceding file transformation is executed, e.g.
    "<code>path + ": Add '" + name + "' from '" + contentsFile + "'"</code>". The parameters of the <var>expr</var>
    depend on the file transformation (see above).
  </dd>
  <dt><code>--iff</code> <var>expr</var></dt>
  <dd>
    Execute the preceding file transformation only iff <var>expr</var> evaluates to true. The parameters of the
    <var>expr</var> depend on the file transformation (see above).
  </dd>
</dl>

<h3>File processing options:</h3>
<dl>
  <dt><code>--look-into</code>                <var>format-glob</var><code>:</code><var>path-glob</var></dt>
  <dd>Look into compressed and archive contents if the format and the path match the glob. The default is to look into
any recognised archive or compressed contents.
<br />
Supported archive formats in this runtime configuration are:
<br />
<code>${archive.formats}</code>
<br />
Supported compression formats in this runtime configuration are:
<br />
<code>${compression.formats}</code></dd>
  <dt><code>--dont-sort-directory-members</code></dt>
  <dd>By default directory members are processed in lexicographical sequence to achieve deterministic results.</dd>
  <dt><code>--patch-file-encoding</code> <var>charset</var></dt>
  <dd>Encoding of patch files (only relevant for "<code>--patch</code>"); the default is "<code>${file.encoding}</code>".</dd>
  <dt><code>--check</code></dt>
  <dd>Do not create or modify any files; exit with status 1 if this is an in-place transformation, and at least one of
the files would be changed.
<p>
  "<code>--check --verbose</code>" also prints the path of the <em>first</em> file or archive entry that would be
  changed.
</p>
<p>
  "<code>--check --verbose --keep-going</code>" prints the pathes of <em>all</em> files and archive entries that
  would be changed.
</p></dd>
  <dt><code>--check-before-transformation</code></dt>
  <dd>Before modifying a file, check whether the change is redundant, i.e. yields an identical result. Could improve
performance if few or no files are actually modified.</dd>
  <dt><code>--keep</code></dt>
  <dd>If existing files would be overwritten, keep copies of the originals.</dd>
  <dt><code>--input-encoding</code> <var>charset</var></dt>
  <dd>Encoding of input files (only relevant for "<code>--substitute</code>" and "<code>--patch</code>"); the default is "<code>${file.encoding}</code>".</dd>
  <dt><code>--output-encoding</code> <var>charset</var></dt>
  <dd>Encoding of output files (only relevant for "<code>--substitute</code>" and "<code>--patch</code>"); the default is "<code>${file.encoding}</code>".</dd>
  <dt><code>--encoding</code> <var>charset</var></dt>
  <dd>All of "--patch-file-encoding", "--input-encoding" and "--output-encoding".</dd>

</dl>

<h3>General options:</h3>
<dl>
  <dt><code>--help</code></dt>
  <dd>Print this text and terminate.</dd>
  <dt><code>--keep-going</code></dt>
  <dd>Print error and continue with next file.</dd>
  <dt><code>--no-warn</code></dt>
  <dd>Suppress all messages except errors.</dd>
  <dt><code>--quiet</code></dt>
  <dd>Suppress normal output.</dd>
  <dt><code>--verbose</code></dt>
  <dd>Print verbose messages.</dd>
  <dt><code>--debug</code></dt>
  <dd>Print verbose and debug messages.</dd>
  <dt><code>--log</code> <var>level</var><code>:</code><var>logger</var><code>:</code><var>handler</var><code>:</code><var>formatter</var><code>:</code><var>format</var></dt>
  <dd>Add logging at level <code>FINE</code> on logger "<code>de.unkrig</code>" to STDERR using the "<code>FormatFormatter</code>"
and "<code>SIMPLE</code>" format, or the given arguments, which are all optional.</dd>

</dl>

<h2>Globs</h2>

<p>
  Check the descriptions of <a
  href="http://commons.unkrig.de/javadoc/de/unkrig/commons/text/pattern/Pattern2.html#WILDCARD">wildcards</a>,
  <a
  href="http://commons.unkrig.de/javadoc/de/unkrig/commons/text/pattern/Glob.html#INCLUDES_EXCLUDES">includes /
  excludes</a> and <a
  href="http://commons.unkrig.de/javadoc/de/unkrig/commons/text/pattern/Glob.html#REPLACEMENT">replacements</a>.
</p>
<p>Examples:</p>
<dl>
  <dt><code>dir/file</code></dt>
  <dd>
    File "file" in directory "dir"
  </dd>
  <dt><code>file.gz%</code></dt>
  <dd>
    Compressed file "file.gz"
  </dd>
  <dt><code>file.zip!dir/file</code></dt>
  <dd>
    Entry "dir/file" in archive file "dir/file.zip"
  </dd>
  <dt><code>file.tar.gz%!dir/file</code></dt>
  <dd>
    Entry "<code>dir/file</code>" in the compressed archive file "<code>file.tar.gz</code>"
  </dd>
  <dt><code>&#42;/x</code></dt>
  <dd>
    File "<code>x</code>" in an immediate subdirectory
  </dd>
  <dt><code>*&#42;/x</code></dt>
  <dd>
    File "<code>x</code>" in any subdirectory
  </dd>
  <dt><code>**&#42;/x</code></dt>
  <dd>
    File "<code>x</code>" in any subdirectory, or any entry "<code>*&#42;/x</code>" in any archive file in any
    subdirectory
  </dd>
  <dt><code>a,dir/file.7z!dir/b</code></dt>
  <dd>
    File "<code>a</code>" and entry "<code>dir/b</code>" in archive file "<code>dir/file.7z</code>"
  </dd>
  <dt><code>~*.c</code></dt>
  <dd>
    Files that don't end with "<code>.c</code>"
  </dd>
  <dt><code>~*.c~*.h</code></dt>
  <dd>
    Files that don't end with "<code>.c</code>" or "<code>.h</code>"
  </dd>
  <dt><code>~*.c~*.h,foo.c</code></dt>
  <dd>
    "<code>foo.c</code>" plus all files that don't end with "<code>.c</code>" or "<code>.h</code>"
  </dd>
</dl>

<h2>Regular expressions and replacements</h2>

<p>
  For the precise description of the supported regular-expression constructs, see <a
  href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#sum">here</a>.
</p>
<p>
  For the precise description of the replacement format, see <a
  href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#appendReplacement%28java.lang.StringBuffer,%20java.lang.String%29">here</a>.
</p>

<h2>Expressions</h2>

<p>
  For the precise description of the supported expression constructs, see <a
  href="http://commons.unkrig.de/javadoc/index.html?de/unkrig/commons/text/expression/Parser.html">here</a>.
</p>
  </body>
</html>
